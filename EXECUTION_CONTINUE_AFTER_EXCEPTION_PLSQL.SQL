CREATE OR REPLACE PROCEDURE PROC_TEST26
AS
  UNAME VARCHAR2(20);
  ERR_CODE NUMBER;
  ERR_MSG  VARCHAR2(600);
  CURSOR C1 IS SELECT SNAME FROM JASPER_SOURCE_TEST26 WHERE FLAG = 0;
BEGIN
  FOR USR IN C1
  LOOP
    BEGIN
      SELECT STNAME INTO UNAME FROM JASPER_STAGG_TEST26 WHERE STNAME = USR.SNAME;
      INSERT INTO JASPER_TARGET_TEST26 VALUES (UNAME);
      UPDATE JASPER_SOURCE_TEST26 SET FLAG = 1 WHERE SNAME = UNAME;
    EXCEPTION
    WHEN NO_DATA_FOUND THEN
    NULL;
    END;
  END LOOP;
EXCEPTION
WHEN OTHERS THEN
INSERT INTO JASPER_ERRORS26 VALUES(ERR_CODE, ERR_MSG);
END;
