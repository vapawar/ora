VARIABLE T_CURSOR REFCURSOR
EXECUTE PROC_TES(PARAM1,PARAM2, :T_CURSOR);
PRINT T_CURSOR
-----------------------------------------------------
--TEST_EXAMPLES--HANDLING MULTIPLE RECORDS IN CURSOR
-----------------------------------------------------
CREATE OR REPLACE PROCEDURE      PROC_JASPER_ADD_USER(RUNID NUMBER, USERID NUMBER)
AS
  CURSOR DATA_CURSOR IS SELECT ROLE_NAME, USER_NAME FROM Z_CLAR_JS_INT WHERE FLAG = 0;
  RNAME VARCHAR2(60);
  UNAME VARCHAR2(60);
  ROLE_ID NUMBER(19);
  USER_ID NUMBER(19);
  ERR_CODE NUMBER;
  ERR_MSG  VARCHAR2(600);
BEGIN
  OPEN DATA_CURSOR;
  LOOP
    FETCH DATA_CURSOR INTO RNAME, UNAME;
    EXIT WHEN DATA_CURSOR%NOTFOUND;
    SELECT ID INTO ROLE_ID FROM JS_USER.JIROLE WHERE ROLENAME = RNAME;
    SELECT ID INTO USER_ID FROM JS_USER.JIUSER WHERE USERNAME = UNAME;
    INSERT INTO JS_USER.JIUSERROLE VALUES(ROLE_ID, USER_ID);
    UPDATE Z_CLAR_JS_INT SET FLAG = 1 WHERE USER_NAME  = UNAME;
  END LOOP;
  COMMIT;
  CLOSE DATA_CURSOR;
EXCEPTION
WHEN NO_DATA_FOUND THEN
  ERR_CODE:= SQLCODE;
  ERR_MSG := SUBSTR(SQLERRM,1,500);
  INSERT INTO JASPER_ERRORS26 VALUES (ERR_CODE, ERR_MSG);
WHEN OTHERS THEN
  ERR_CODE:= SQLCODE;
  ERR_MSG := SUBSTR(SQLERRM,1,500);
  INSERT INTO JASPER_ERRORS26 VALUES(ERR_CODE, ERR_MSG);
END;
